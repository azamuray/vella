<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>VELLA - Zombie Shooter</title>

    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Phaser.js -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>

    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Loading screen -->
    <div id="loading-screen">
        <div class="loader">
            <div class="zombie-icon">üßü</div>
            <h1>VELLA</h1>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            <div class="progress-bar">
                <div class="progress-fill" id="load-progress"></div>
            </div>
        </div>
    </div>

    <!-- Main menu -->
    <div id="menu-screen" class="screen hidden">
        <div class="menu-container">
            <h1 class="game-title">üßü VELLA</h1>
            <p class="subtitle">–í—ã–∂–∏–≤–∞–Ω–∏–µ —Å—Ä–µ–¥–∏ –∑–æ–º–±–∏</p>

            <div class="player-info">
                <div class="stat">
                    <span class="icon">üí∞</span>
                    <span id="player-coins">0</span>
                </div>
                <div class="stat">
                    <span class="icon">üíÄ</span>
                    <span id="player-kills">0</span>
                </div>
                <div class="stat">
                    <span class="icon">üåä</span>
                    <span id="player-wave">0</span>
                </div>
            </div>

            <div class="menu-buttons">
                <button class="btn btn-primary" id="btn-create-room">
                    <span class="icon">‚ûï</span> –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É
                </button>
                <button class="btn btn-secondary" id="btn-browse-rooms">
                    <span class="icon">üåê</span> –ù–∞–π—Ç–∏ –∏–≥—Ä—É
                </button>
                <button class="btn btn-secondary" id="btn-shop">
                    <span class="icon">üî´</span> –ú–∞–≥–∞–∑–∏–Ω
                </button>
                <button class="btn btn-secondary" id="btn-leaderboard">
                    <span class="icon">üèÜ</span> –õ–∏–¥–µ—Ä–±–æ—Ä–¥
                </button>
            </div>

            <div class="menu-divider"></div>

            <div class="menu-buttons">
                <button class="btn btn-accent" id="btn-open-world">
                    <span class="icon">üó∫Ô∏è</span> –û—Ç–∫—Ä—ã—Ç—ã–π –º–∏—Ä <span class="beta-badge">Beta</span>
                </button>
                <button class="btn btn-secondary" id="btn-clan">
                    <span class="icon">‚öîÔ∏è</span> –ö–ª–∞–Ω <span class="beta-badge">Beta</span>
                </button>
            </div>

            <div class="equipped-weapon">
                <span>–û—Ä—É–∂–∏–µ: </span>
                <span id="equipped-weapon-name">Glock 17</span>
            </div>
        </div>
    </div>

    <!-- Lobby screen -->
    <div id="lobby-screen" class="screen hidden">
        <div class="lobby-container">
            <h2>–ö–æ–º–Ω–∞—Ç–∞: <span id="room-code">------</span></h2>
            <button class="btn-copy" id="btn-copy-code">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>

            <div class="players-list" id="lobby-players">
                <!-- Players will be added here -->
            </div>

            <div class="lobby-buttons">
                <button class="btn btn-primary" id="btn-ready">
                    <span id="ready-text">–ì–æ—Ç–æ–≤</span>
                </button>
                <button class="btn btn-danger" id="btn-leave">–í—ã–π—Ç–∏</button>
            </div>

            <p class="lobby-hint">–ù–∞–∂–º–∏ –ì–æ—Ç–æ–≤ —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å (1-10 –∏–≥—Ä–æ–∫–æ–≤)</p>
            <div class="controls-hint">
                <p>üïπÔ∏è –õ–µ–≤—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ ‚Äî –î–≤–∏–∂–µ–Ω–∏–µ</p>
                <p>üéØ –ü—Ä–∞–≤—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ ‚Äî –ü—Ä–∏—Ü–µ–ª –∏ —Å—Ç—Ä–µ–ª—å–±–∞</p>
            </div>
        </div>
    </div>

    <!-- Shop screen -->
    <div id="shop-screen" class="screen hidden">
        <div class="shop-container">
            <div class="shop-header">
                <button class="btn-back" id="btn-shop-back">‚Üê –ù–∞–∑–∞–¥</button>
                <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
                <div class="coins">üí∞ <span id="shop-coins">0</span></div>
            </div>

            <!-- Ready button in shop (only visible during wave break) -->
            <div id="shop-ready-bar" class="shop-ready-bar hidden">
                <span id="shop-ready-status">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
                <button class="btn btn-primary btn-sm" id="btn-shop-ready">‚úì –ì–æ—Ç–æ–≤</button>
            </div>

            <div class="weapons-grid" id="weapons-list">
                <!-- Weapons will be added here -->
            </div>
        </div>
    </div>

    <!-- Leaderboard screen -->
    <div id="leaderboard-screen" class="screen hidden">
        <div class="leaderboard-container">
            <div class="shop-header">
                <button class="btn-back" id="btn-leaderboard-back">‚Üê –ù–∞–∑–∞–¥</button>
                <h2>üèÜ –õ–∏–¥–µ—Ä–±–æ—Ä–¥</h2>
                <div></div>
            </div>
            <div id="leaderboard-list" class="leaderboard-list">
                <p class="loading-rooms">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>
        </div>
    </div>

    <!-- Exit confirmation modal -->
    <div id="exit-modal" class="modal hidden">
        <div class="modal-content">
            <h3>–í—ã–π—Ç–∏ –∏–∑ –∏–≥—Ä—ã?</h3>
            <p class="exit-text">–ü—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω.</p>
            <div class="modal-buttons">
                <button class="btn btn-danger" id="btn-exit-confirm">–í—ã–π—Ç–∏</button>
                <button class="btn btn-secondary" id="btn-exit-cancel">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- Browse rooms modal -->
    <div id="rooms-modal" class="modal hidden">
        <div class="modal-content rooms-modal">
            <h3>üåê –ü—É–±–ª–∏—á–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã</h3>
            <div class="rooms-list" id="rooms-list">
                <p class="loading-rooms">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" id="btn-rooms-refresh">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                <button class="btn btn-secondary" id="btn-rooms-cancel">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Clan screen -->
    <div id="clan-screen" class="screen hidden">
        <div class="clan-container">
            <div class="shop-header">
                <button class="btn-back" id="btn-clan-back">‚Üê –ù–∞–∑–∞–¥</button>
                <h2>–ö–ª–∞–Ω</h2>
                <div></div>
            </div>

            <!-- No clan state -->
            <div id="clan-no-clan">
                <p class="clan-empty-text">–¢—ã –Ω–µ –≤ –∫–ª–∞–Ω–µ</p>
                <div class="clan-create-form">
                    <input type="text" id="clan-name-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞–Ω–∞" maxlength="128">
                    <input type="number" id="clan-chat-id-input" placeholder="Telegram Chat ID">
                    <button class="btn btn-primary" id="btn-clan-create">–°–æ–∑–¥–∞—Ç—å –∫–ª–∞–Ω</button>
                </div>
                <div class="clan-join-form">
                    <input type="number" id="clan-join-id-input" placeholder="ID –∫–ª–∞–Ω–∞">
                    <button class="btn btn-secondary" id="btn-clan-join">–í—Å—Ç—É–ø–∏—Ç—å</button>
                </div>
            </div>

            <!-- In clan state -->
            <div id="clan-info" class="hidden">
                <h3 id="clan-name-display">‚Äî</h3>
                <div class="clan-resources">
                    <span>‚õèÔ∏è <span id="clan-metal">0</span></span>
                    <span>ü™µ <span id="clan-wood">0</span></span>
                    <span>üçñ <span id="clan-food">0</span></span>
                    <span>üî´ <span id="clan-ammo">0</span></span>
                    <span>üíä <span id="clan-meds">0</span></span>
                </div>

                <div class="clan-members" id="clan-members-list">
                    <!-- Members rendered here -->
                </div>

                <div class="clan-actions">
                    <button class="btn btn-primary" id="btn-clan-base">üèóÔ∏è –ë–∞–∑–∞</button>
                    <button class="btn btn-secondary" id="btn-clan-deposit">üì¶ –°–¥–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã</button>
                    <button class="btn btn-danger" id="btn-clan-leave">–ü–æ–∫–∏–Ω—É—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Base screen -->
    <div id="base-screen" class="screen hidden">
        <div class="base-container">
            <div class="shop-header">
                <button class="btn-back" id="btn-base-back">‚Üê –ù–∞–∑–∞–¥</button>
                <h2>–ë–∞–∑–∞ –∫–ª–∞–Ω–∞</h2>
                <div></div>
            </div>
            <div class="base-resources-bar" id="base-resources-bar">
                <span>‚õèÔ∏è <span id="base-res-metal">0</span></span>
                <span>ü™µ <span id="base-res-wood">0</span></span>
                <span>üçñ <span id="base-res-food">0</span></span>
                <span>üî´ <span id="base-res-ammo">0</span></span>
                <span>üíä <span id="base-res-meds">0</span></span>
            </div>
            <canvas id="base-canvas"></canvas>
            <div id="build-menu" class="build-menu"></div>
        </div>
    </div>

    <!-- Game container -->
    <div id="game-container" class="hidden"></div>

    <!-- Joystick zones (outside game canvas) -->
    <div id="joystick-left" class="joystick-zone hidden"></div>
    <div id="joystick-right" class="joystick-zone hidden"></div>

    <!-- HUD (overlay on game) -->
    <div id="hud" class="hidden">
        <!-- Pause button -->
        <button id="btn-pause" class="pause-btn">‚è∏</button>
        <!-- Debug button -->
        <button id="btn-kill-all" class="debug-btn">‚ò†Ô∏è –£–±–∏—Ç—å –≤—Å–µ—Ö</button>
        <div class="hud-top">
            <div class="wave-info">
                <span class="label">–í–æ–ª–Ω–∞</span>
                <span id="hud-wave">1</span>
            </div>
            <div class="zombies-info">
                <span class="label">üßü</span>
                <span id="hud-zombies">0</span>
            </div>
            <div class="kills-info">
                <span class="label">üíÄ</span>
                <span id="hud-kills">0</span>
            </div>
            <div class="coins-info">
                <span class="label">üí∞</span>
                <span id="hud-coins">0</span>
            </div>
        </div>

        <div class="hud-bottom">
            <div class="health-bar">
                <div class="health-fill" id="hud-health"></div>
                <span class="health-text" id="hud-health-text">100/100</span>
            </div>
            <div class="ammo-info">
                <span id="hud-ammo">17</span> / <span id="hud-max-ammo">17</span>
                <span id="hud-weapon-name">Glock 17</span>
            </div>
            <div class="reload-bar hidden" id="reload-bar">
                <div class="reload-fill" id="reload-fill"></div>
            </div>
        </div>
    </div>

    <!-- World HUD -->
    <div id="world-hud" class="hidden">
        <div class="world-hud-top">
            <button id="btn-world-pause" class="pause-btn">‚è∏</button>
            <div class="world-resources-bar">
                <span>‚õèÔ∏è <span id="world-metal">0</span></span>
                <span>ü™µ <span id="world-wood">0</span></span>
                <span>üçñ <span id="world-food">0</span></span>
                <span>üî´ <span id="world-ammo">0</span></span>
                <span>üíä <span id="world-meds">0</span></span>
            </div>
            <button id="btn-goto-base" class="btn-base hidden">üè† <span id="base-distance">--</span></button>
        </div>
        <div class="world-minimap-wrap">
            <canvas id="world-minimap" width="120" height="120"></canvas>
        </div>
        <div id="equipment-hud" style="display:none;">
            <div class="eq-slot" data-slot="head">--</div>
            <div class="eq-slot" data-slot="body">--</div>
            <div class="eq-slot" data-slot="legs">--</div>
            <div class="armor-value">0%</div>
        </div>
        <div class="world-hud-bottom">
            <div class="health-bar">
                <div class="health-fill" id="world-health"></div>
                <span class="health-text" id="world-health-text">100/100</span>
            </div>
            <span id="world-weapon-ammo" class="world-ammo-text">17/17</span>
            <button class="btn btn-small btn-medkit" id="btn-use-medkit">üíä –ê–ø—Ç–µ—á–∫–∞</button>
            <button class="btn btn-small btn-collect" id="btn-collect-resource">üì¶ –°–æ–±—Ä–∞—Ç—å</button>
            <div class="base-actions-wrap hidden" id="base-actions-wrap">
                <button class="base-actions-toggle" id="base-actions-toggle">üè† –ë–∞–∑–∞ ‚ñ≤</button>
                <div class="base-actions-dropdown hidden" id="base-actions-dropdown">
                    <button class="btn btn-small" id="btn-deposit-base" style="background:#1a3a5f;">üè† –°–¥–∞—Ç—å</button>
                    <button class="btn btn-small" id="btn-world-build" style="background:#2d5a1e;">üèóÔ∏è –°—Ç—Ä–æ–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Building interaction panel -->
    <div id="building-panel" class="modal hidden">
        <div class="modal-content" style="max-width: 280px;">
            <h3 id="bp-title" style="margin: 0 0 8px; font-size: 14px;"></h3>
            <p id="bp-info" style="font-size: 12px; color: #aaa; margin: 0 0 12px;"></p>
            <div id="bp-collect-row" class="hidden" style="margin-bottom: 8px;">
                <button class="btn btn-small" id="bp-collect" style="background: #2d5a1e; width: 100%;">üì¶ –°–æ–±—Ä–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã (<span id="bp-collect-amount">0</span>)</button>
            </div>
            <div style="display: flex; gap: 8px;">
                <button class="btn btn-small" id="bp-move" style="background: #1a3a5f; flex: 1;">‚ÜïÔ∏è –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å</button>
                <button class="btn btn-small" id="bp-demolish" style="background: #8b0000; flex: 1;">üóë –°–Ω–µ—Å—Ç–∏</button>
            </div>
            <button class="btn btn-small" id="bp-close" style="margin-top: 8px; width: 100%; background: #333;">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- World exit confirmation -->
    <div id="world-exit-modal" class="modal hidden">
        <div class="modal-content">
            <h3>–í—ã–π—Ç–∏ –∏–∑ –º–∏—Ä–∞?</h3>
            <p class="exit-text">–ü—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω.</p>
            <div class="modal-buttons">
                <button class="btn btn-danger" id="btn-world-exit-confirm">–í—ã–π—Ç–∏</button>
                <button class="btn btn-secondary" id="btn-world-exit-cancel">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- Wave announcement -->
    <div id="wave-announcement" class="hidden">
        <h2>–í–æ–ª–Ω–∞ <span id="announce-wave">1</span></h2>
        <p id="announce-zombies">10 –∑–æ–º–±–∏ –ø—Ä–∏–±–ª–∏–∂–∞—é—Ç—Å—è</p>
    </div>

    <!-- Wave complete overlay -->
    <div id="wave-complete" class="screen hidden">
        <div class="wave-complete-container">
            <h2>–í–æ–ª–Ω–∞ <span id="complete-wave">1</span> –ø—Ä–æ–π–¥–µ–Ω–∞!</h2>
            <div class="wave-bonus">+<span id="wave-bonus">50</span> –º–æ–Ω–µ—Ç</div>
            <p class="next-wave-text">–°–ª–µ–¥—É—é—â–∞—è: –í–æ–ª–Ω–∞ <span id="next-wave-num">2</span></p>
            <p class="ready-status" id="ready-status">–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...</p>
            <div class="wave-complete-buttons">
                <button class="btn btn-primary" id="btn-next-wave">
                    ‚úì –ì–æ—Ç–æ–≤
                </button>
                <button class="btn btn-secondary" id="btn-wave-shop">
                    üî´ –ú–∞–≥–∞–∑–∏–Ω
                </button>
            </div>
        </div>
    </div>

    <!-- Game over screen -->
    <div id="gameover-screen" class="screen hidden">
        <div class="gameover-container">
            <h1>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</h1>
            <div class="final-stats">
                <div class="stat-row">
                    <span>–í–æ–ª–Ω–∞</span>
                    <span id="final-wave">0</span>
                </div>
                <div class="stat-row">
                    <span>–£–±–∏–π—Å—Ç–≤</span>
                    <span id="final-kills">0</span>
                </div>
                <div class="stat-row">
                    <span>–ú–æ–Ω–µ—Ç</span>
                    <span id="final-coins">0</span>
                </div>
            </div>

            <div class="leaderboard" id="final-leaderboard">
                <!-- Player stats will be added here -->
            </div>

            <button class="btn btn-primary" id="btn-play-again">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
            <button class="btn btn-secondary" id="btn-back-menu">–í –º–µ–Ω—é</button>
        </div>
    </div>

    <!-- Toast notifications -->
    <div id="toast-container"></div>

    <script type="module" src="/js/main.js?v=30"></script>
</body>
</html>
